<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" type="text/css" href="/theme/css/elegant.prod.9e9d5ce754.css" media="screen">
        <link rel="stylesheet" type="text/css" href="/theme/css/custom.css" media="screen">

        <link rel="dns-prefetch" href="//fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>

        <meta name="author" content="MFIN7036 Students 2025" />

        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="Group Language Magician, Reflective Report, " />

<meta property="og:title" content="Data Collection, Data Visualization, Regression, and Machine Learning in Annual Reports (by Group &#34;Language Magician&#34;) "/>
<meta property="og:url" content="/data-collection-data-visualization-regression-and-machine-learning-in-annual-reports-by-group-language-magician.html" />
<meta property="og:description" content="By Group &#34;Language Magician&#34; 1. Introduction Our project aims to study the relationship between the companies&#39; stock performance and the hedging words frequencies as the textual precision information in their annual reports. Thus, this blog introduces our explorations on the NLP processing methods and improvements we made to derive the …" />
<meta property="og:site_name" content="MFIN7036 Student Blog 2025" />
<meta property="og:article:author" content="MFIN7036 Students 2025" />
<meta property="og:article:published_time" content="2025-03-10T00:00:00+08:00" />
<meta name="twitter:title" content="Data Collection, Data Visualization, Regression, and Machine Learning in Annual Reports (by Group &#34;Language Magician&#34;) ">
<meta name="twitter:description" content="By Group &#34;Language Magician&#34; 1. Introduction Our project aims to study the relationship between the companies&#39; stock performance and the hedging words frequencies as the textual precision information in their annual reports. Thus, this blog introduces our explorations on the NLP processing methods and improvements we made to derive the …">

        <title>Data Collection, Data Visualization, Regression, and Machine Learning in Annual Reports (by Group &#34;Language Magician&#34;)  · MFIN7036 Student Blog 2025
</title>



    </head>
    <body>
        <div id="content">
            <div class="navbar navbar-static-top">
                <div class="navbar-inner">
                    <div class="container-fluid">
                        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </a>
                        <a class="brand" href="/"><span class=site-name>MFIN7036 Student Blog 2025</span></a>
                        <div class="nav-collapse collapse">
                            <ul class="nav pull-right top-menu">
                                <li >
                                    <a href=
                                       "/"
                                    >Home</a>
                                </li>
                                <li ><a href="/categories.html">Categories</a></li>
                                <li ><a href="/tags.html">Tags</a></li>
                                <li ><a href="/archives.html">Archives</a></li>
                                <li><form class="navbar-search" action="/search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span1"></div>
                    <div class="span10">
<article itemscope>
<div class="row-fluid">
    <header class="page-header span10 offset2">
        <h1>
            <a href="/data-collection-data-visualization-regression-and-machine-learning-in-annual-reports-by-group-language-magician.html">
                Data Collection, Data Visualization, Regression, and Machine Learning in Annual Reports (by Group "Language Magician")
            </a>
        </h1>
    </header>
</div>

<div class="row-fluid">
        <div class="span8 offset2 article-content">
            
            <p>By Group "Language Magician"</p>
<h2>1. Introduction</h2>
<p>Our project aims to study the relationship between the companies' stock performance and the hedging words frequencies as the textual precision information in their annual reports. Thus, this blog introduces our explorations on the NLP processing methods and improvements we made to derive the ambiguous of annual report, collect stock performance, and show the progress of regression and machine learning when we study the relationship of the language ambiguity of company annual reports and their stock returns.</p>
<p>The main sections of this blog would be: 1. Further NLP of Annual Report; 2. Data Collection and Processing of Stock Price, 3. Regression based on data collected and 4. Supervised Machine Learning, please see later blog.</p>
<h2>2. Annual Report Data Collection and NLP</h2>
<h3>2.1 Annual Report Collection</h3>
<p>In the last Blog, we have mentioned that the annual reports of four companies (such as HON) do not follow the regular structure, resulting in the inability to effectively recognize the "Business", "Risk Factors", and "Management's Discussion and Analysis of Financial Condition and Results of Operations" sections. Thus, we use an alternative way to get the textual data of the three section of the annual report of these four companies from their pdf version of annual report. And we use library <a href="https://github.com/jsvine/pdfplumber">pdfplumber</a> to get the textual data from the annual report, and add it manually to the csv document we needed for later analysis.</p>
<h4>Using pdfplumber to get the textual data from pdf version of annual report</h4>
<div class="highlight"><pre><span></span><code> <span class="kn">import</span> <span class="nn">pdfplumber</span>
 <span class="n">txtpath</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;Annual_Report.txt&quot;</span>
 <span class="n">pdfpath</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;Annual_Report.pdf&quot;</span>
 <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">txtpath</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">,</span><span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">txt</span><span class="p">:</span>  <span class="c1"># create the txt file</span>
    <span class="k">with</span> <span class="n">pdfplumber</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">pdfpath</span><span class="p">)</span> <span class="k">as</span> <span class="n">pdf</span><span class="p">:</span>  <span class="c1"># open the pdf file</span>
        <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">pdf</span><span class="o">.</span><span class="n">pages</span><span class="p">:</span>
            <span class="n">txt</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">page</span><span class="o">.</span><span class="n">extract_text</span><span class="p">())</span>
</code></pre></div>

<h3>2.2 Dealing with Annual Report of 30 companies in 4 years (2020-2023)</h3>
<p>To deal with other companies, we apply the library <a href="https://github.com/dgunning/edgartools">edgartools</a>. Besides, we also get the release date of those annual reports, which would be essential for our collection of stock price on the annual report release date, after 20 trading days, 120 trading days and 252 trading days.</p>
<h4>Step 1: Collection in Annual Report filing date:</h4>
<p>Here we get the filing date of the annual reports and store it in the csv document for future stock price collection. And to improve the efficiency of computation in getting data, we use library <a href="https://docs.python.org/zh-cn/3.12/library/asyncio.html">asyncio</a> to assist the process. </p>
<div class="highlight"><pre><span></span><code> <span class="kn">from</span> <span class="nn">edgar</span> <span class="kn">import</span> <span class="n">Company</span><span class="p">,</span> <span class="n">set_identity</span>
 <span class="kn">import</span> <span class="nn">asyncio</span>
 <span class="n">set_identity</span><span class="p">(</span><span class="s1">&#39;example@example.com&#39;</span><span class="p">)</span>
 <span class="n">COMPANY_LIST</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;MMM&quot;</span><span class="p">,</span> <span class="s2">&quot;AXP&quot;</span><span class="p">,</span> <span class="s2">&quot;AMGN&quot;</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="s2">&quot;WMT&quot;</span><span class="p">]</span>
 <span class="n">YEAR_START</span> <span class="o">=</span> <span class="mi">2020</span>
 <span class="n">YEAR_END</span> <span class="o">=</span> <span class="mi">2023</span>
 <span class="k">async</span> <span class="k">def</span> <span class="nf">fetch_company_data</span><span class="p">(</span><span class="n">ticker</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">year</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">com</span> <span class="o">=</span> <span class="n">Company</span><span class="p">(</span><span class="n">ticker</span><span class="p">)</span>
        <span class="n">com_file</span> <span class="o">=</span> <span class="n">com</span><span class="o">.</span><span class="n">get_filings</span><span class="p">(</span><span class="n">form</span><span class="o">=</span><span class="s2">&quot;10-K&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">latest</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">com_2</span> <span class="o">=</span> <span class="n">com_file</span><span class="p">[</span><span class="mi">2024</span> <span class="o">-</span> <span class="n">year</span><span class="p">]</span><span class="o">.</span><span class="n">obj</span><span class="p">()</span>

        <span class="c1"># Get Required Section of Annual Report</span>
        <span class="n">item1</span> <span class="o">=</span> <span class="n">com_2</span><span class="p">[</span><span class="s1">&#39;Item 1&#39;</span><span class="p">]</span>
        <span class="n">item1a</span> <span class="o">=</span> <span class="n">com_2</span><span class="p">[</span><span class="s1">&#39;Item 1A&#39;</span><span class="p">]</span>
        <span class="n">item7</span> <span class="o">=</span> <span class="n">com_2</span><span class="p">[</span><span class="s1">&#39;Item 7&#39;</span><span class="p">]</span>

        <span class="c1"># Get the filing date</span>
        <span class="k">if</span> <span class="mi">2024</span> <span class="o">-</span> <span class="n">year</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">com_file</span><span class="p">):</span>
            <span class="n">filing_date</span> <span class="o">=</span> <span class="n">com_file</span><span class="p">[</span><span class="mi">2024</span> <span class="o">-</span> <span class="n">year</span><span class="p">]</span><span class="o">.</span><span class="n">filing_date</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="kc">None</span>
        <span class="k">return</span> <span class="n">item1</span><span class="p">,</span> <span class="n">item1a</span><span class="p">,</span> <span class="n">item7</span><span class="p">,</span> <span class="n">filing_date</span>

     <span class="k">except</span> <span class="p">(</span><span class="ne">IndexError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error fetching data for </span><span class="si">{</span><span class="n">ticker</span><span class="si">}</span><span class="s2"> in </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="kc">None</span>
</code></pre></div>

<h4>Step 2: Collect one more year of Annual reports as the testing dataset</h4>
<p>Based on our research progress, we decided to train a model that learn from the relationship between the hedging word frequency and stock performance. Thus, we also collect the most recent information as the testing set to see the accuracy of our trained model. And for data storage, we use library <a href="https://pandas.pydata.org">pandas</a> for assistance.</p>
<div class="highlight"><pre><span></span><code> <span class="c1"># ...(same code as blog 1)</span>
 <span class="c1"># Here are the main improvements</span>
 <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
  <span class="n">data_list</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span>
        <span class="n">COMPANY_LIST</span><span class="p">[</span><span class="n">i</span> <span class="o">//</span> <span class="p">(</span><span class="n">YEAR_END</span> <span class="o">-</span> <span class="n">YEAR_START</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)],</span> 
        <span class="n">YEAR_START</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="p">(</span><span class="n">YEAR_END</span> <span class="o">-</span> <span class="n">YEAR_START</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)),</span> 
        <span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">))</span>
     <span class="p">]</span>

     <span class="c1"># Create a DataFrame and save to CSV</span>
     <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="n">data_list</span><span class="p">,</span> 
        <span class="n">columns</span><span class="o">=</span>\
            <span class="p">[</span><span class="s1">&#39;Company&#39;</span><span class="p">,</span> <span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="s1">&#39;Item 1&#39;</span><span class="p">,</span> <span class="s1">&#39;Item 1A&#39;</span><span class="p">,</span> <span class="s1">&#39;Item 7&#39;</span><span class="p">,</span> <span class="s1">&#39;Filing Date&#39;</span><span class="p">]</span>
        <span class="p">)</span>
     <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;first_version_annual_reports.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
     <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Data has been written to first_version_annual_reports.csv&quot;</span><span class="p">)</span>
</code></pre></div>

<h3>2.3 Ambiguity Statistics for 30 companies annual report over the four year period (2020-2023)</h3>
<p>After Blog 1 trail in dealing with sample set of the annual reports and processing the hedging word frequency, we improve our programming and apply it to all 30 company's report over the recent four year period. Besides, we also add more valuing criteria such as the sentiment score, complexity of sentences and words to evaluate the ambiguitiness of Annual Report. And below are the major improvements after Blog 1 coding.</p>
<h4>Improvement 1: Use all 30 company's four-year annual report</h4>
<p>As we have get more data in companies' annual report, in the data visualization, we would apply a bigger dataset. And to get data from the previous document we saved, we use library <a href="https://pandas.pydata.org">pandas</a>.</p>
<div class="highlight"><pre><span></span><code> <span class="c1"># Get data from csv document generated in previous steps</span>
 <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
 <span class="n">df</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;full_version_annual_reports.csv&quot;</span><span class="p">)</span>
 <span class="n">df</span><span class="p">[</span><span class="s1">&#39;combined_text&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Item 1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;string&#39;</span><span class="p">)</span>\
                        <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Item 1A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;string&#39;</span><span class="p">)</span>\
                        <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Item 7&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;string&#39;</span><span class="p">)</span>

 <span class="c1"># Get rid of NaNs                       </span>
 <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;combined_text&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
 <span class="n">txt</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;combined_text&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;string&#39;</span><span class="p">)</span>
</code></pre></div>

<h4>Imporvement 2: Data Visualization of Hedging Word Frequency (Using Heatmap)</h4>
<p>Instead of using the bar chart as in Blog 1, here we use the heatmap to better illustrate and compare the Hedging Word Frequency in different companies annual report and their changes across different years. To generate heatmap, we use the library <a href="https://matplotlib.org">matplotlib</a>. And we will show the heatmap result based on (1) absolute counts of hedging words (Uncertainty Score), and (2) percentage frequency of hedging words (Hedging Word Frequency):</p>
<div class="highlight"><pre><span></span><code> <span class="c1"># Get data from previous processed excel</span>
 <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s1">&#39;company&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">])</span>
 <span class="n">df_grouped</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;company&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span>
    <span class="s1">&#39;Uncertainty_Frequency_Percentage&#39;</span><span class="p">:</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span>
    <span class="s1">&#39;uncertainty_score&#39;</span><span class="p">:</span> <span class="s1">&#39;mean&#39;</span>
    <span class="p">})</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</code></pre></div>

<h5>1. Heatmap of Uncertainty Score</h5>
<p>After we collect the data of Uncertainty Score, we apply the blow code to visualize the Uncertainty Score of different companies across four years: </p>
<div class="highlight"><pre><span></span><code> <span class="c1"># Create a heatmap of the Uncertainty Score by company and year</span>
 <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
 <span class="n">pivot_table</span> <span class="o">=</span> <span class="n">df_grouped</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span>
    <span class="n">index</span><span class="o">=</span><span class="s1">&#39;company&#39;</span><span class="p">,</span>
    <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;year&#39;</span><span class="p">,</span>
    <span class="n">values</span><span class="o">=</span><span class="s1">&#39;uncertainty_score&#39;</span>
    <span class="p">)</span>
 <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
 <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span>
    <span class="n">pivot_table</span><span class="p">,</span>
    <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;YlGnBu&#39;</span><span class="p">,</span> 
    <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.0f&quot;</span>  
    <span class="p">)</span>
 <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Uncertainty Score by Company and Year&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
 <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
 <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Company&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
 <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

<p><img alt="Uncertainty Score Heatmap" src="./images/group-LanguageMagician_02_image-UncertaintyScore_Heatmap.png"></p>
<h5>2. Heatmap of Hedging Word Frequency</h5>
<p>Then, we collect the data of Hedging Word Frequency. And we apply the code similar to above code to visualize the Hedging Word Frequency of different companies across four years: </p>
<p><img alt="Hedging Word Frequency Heatmap" src="./images/group-LanguageMagician_02_image-HedgingWordFrequency_Heatmap.png"></p>
<h4>Imporvement 3: Data Visualization of Sentiment Score and Complexity of Sentences and Words (Using Heatmap)</h4>
<p>Besides the Hedging Word Frequency we have used in Blog1, our group also would like to consider other ambiguity features in the Annual Report. We consider the three factors: (1) the Sentiment Score, (2) The complexity of Sentencies, (3) The complexity of words. And besides library <a href="https://matplotlib.org">matplotlib</a>, here we also use library <a href="https://seaborn.pydata.org">seaborn</a> to assist the drawing of Heatmap.</p>
<h5>1. Heatmap of Sentiment Score</h5>
<p>For the Sentiment Score, we count the frequency ofthe positive words and negative words in the previous dictionary we use. And below is the heatmap from the data analysis.</p>
<div class="highlight"><pre><span></span><code> <span class="c1"># Get Sentiment Score</span>
 <span class="k">def</span> <span class="nf">financial_sentiment</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="n">tokens</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="n">total_words</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span>

    <span class="n">pos_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">([</span><span class="n">word</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">tokens</span> <span class="k">if</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">positive_words</span><span class="p">])</span>
    <span class="n">neg_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">([</span><span class="n">word</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">tokens</span> <span class="k">if</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">negative_words</span><span class="p">])</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">pos_count</span> <span class="o">-</span> <span class="n">neg_count</span><span class="p">)</span> <span class="o">/</span> <span class="n">total_words</span>

 <span class="c1"># Create a heatmap of the sentiment score by company and year</span>
 <span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
 <span class="n">pivot_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span>
    <span class="n">index</span><span class="o">=</span><span class="s1">&#39;Company&#39;</span><span class="p">,</span>
    <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span>
    <span class="n">values</span><span class="o">=</span><span class="s1">&#39;sentiment_score&#39;</span><span class="p">,</span>
    <span class="n">aggfunc</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span>  
 <span class="p">)</span>

 <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
 <span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">font_scale</span><span class="o">=</span><span class="mf">1.2</span><span class="p">)</span>

 <span class="n">heatmap</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span>
    <span class="n">pivot_df</span><span class="p">,</span>
    <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  
    <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.2f&quot;</span><span class="p">,</span>   
    <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;RdYlGn&quot;</span><span class="p">,</span>  
    <span class="n">center</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>     
    <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">annot_kws</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span>
    <span class="n">cbar_kws</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Sentiment Intensity&#39;</span><span class="p">}</span>
 <span class="p">)</span>

 <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Sentiment Score by Company and Year&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
 <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Year&quot;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
 <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Company&quot;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
 <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
 <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
 <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

<p><img alt="Sentiment Score Heatmap" src="./images/group-LanguageMagician_02_image-SentimentScore_Heatmap.png">
 Here we can see that the Sentiment Scores for different companies are almost zero, which means that there is no much difference in the sentiment score for different companies in different years. And after discussion, out group decide not to include the sentiment score in our later machine learning.</p>
<h5>2. Heatmap of Sentence Complexity (Length of Sentence)</h5>
<p>For the Complexity of Sentence, we use the length of the Sentence as reference. And below is the heatmap from the data analysis. And for detailed calculation in python, you can see the code for report as reference. For Heatmap generattion, it is similar to previous code.</p>
<p><img alt="Avg Sentence Length Heatmap" src="./images/group-LanguageMagician_02_image-AvgSenLen_Heatmap.png"></p>
<h5>3. Heatmap of Word Complexity (Syllables of Sentence)</h5>
<p>For the Complexity of Word, we use the Syllables that a word has as reference. The more syllables a word has, the more complexity the word would be. And below is the heatmap from the data analysis.</p>
<p><img alt="Word Complexity Heatmap" src="./images/group-LanguageMagician_02_image-ComplexWord_Heatmap.png"></p>
<h2>3. Stock Price Collection</h2>
<p>In this section, we will explain and illustrate how our group get the stock price of the related companies on their annual report release date, after 20/120/252 trading days. To collect the adjusted closing stock price on Yahoo Finance, we use the library <a href="https://pypi.org/project/yfinance/">yfinance</a>.  And we use library <a href="https://numpy.org">numpy</a> to assist with the data processing. And we will discuss the difficulties we encountered and how we solve it. </p>
<h3>3.1 Initial Version of Stock Price Collection</h3>
<h4>Step 1. Get the Company Name and Dates</h4>
<p>To get the adjusted closing stock price, we first get the company name and annual report release time from the previous steps. And we created an empty list to store the closing price we are going to get.</p>
<div class="highlight"><pre><span></span><code> <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
 <span class="kn">import</span> <span class="nn">yfinance</span> <span class="k">as</span> <span class="nn">yf</span>
 <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
 <span class="c1"># Read Excel file</span>
 <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
 <span class="n">file_path</span> <span class="o">=</span> <span class="s1">&#39;full_version_annual_reports.csv&#39;</span>
 <span class="c1"># the ticker simbol column is &#39;Company&#39;，date column is &#39;Filing_Date&#39;</span>
 <span class="n">tickers</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Company&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
 <span class="n">dates</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Filing Date&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
 <span class="c1"># store the stock close price data</span>
 <span class="n">close_prices</span> <span class="o">=</span> <span class="p">[]</span>
</code></pre></div>

<h4>Step 2. Get the stock price on Annual Report Release Date</h4>
<p>After we get the Company Names and Annual Report Release Dates, we tried to get the closing stock price of the specified company on their annual report release date.</p>
<div class="highlight"><pre><span></span><code> <span class="k">for</span> <span class="n">ticker</span><span class="p">,</span> <span class="n">date</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">tickers</span><span class="p">,</span> <span class="n">dates</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># get price data from Yahoo Finance, from start date:</span>
        <span class="n">stock</span> <span class="o">=</span> <span class="n">yf</span><span class="o">.</span><span class="n">Ticker</span><span class="p">(</span><span class="n">ticker</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">stock</span><span class="o">.</span><span class="n">history</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">date</span><span class="p">)</span>

        <span class="c1"># find the 1st recorded date</span>
        <span class="n">first_valid_date</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">row</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Company&#39;</span><span class="p">:</span> <span class="n">ticker</span><span class="p">,</span>
            <span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="n">date</span>
            <span class="p">}</span>
            <span class="c1"># get the stock price of the first day</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">close_price</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">first_valid_date</span><span class="p">,</span> <span class="s1">&#39;Close&#39;</span><span class="p">]</span>
            <span class="n">row</span><span class="p">[</span><span class="s1">&#39;close_price&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">close_price</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">row</span><span class="p">[</span><span class="s1">&#39;close_price&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Didn&#39;t find </span><span class="si">{</span><span class="n">ticker</span><span class="si">}</span><span class="s2"> on </span><span class="si">{</span><span class="n">first_valid_date</span><span class="si">}</span><span class="s2"> &#39;s price。&quot;</span><span class="p">)</span>
        <span class="n">close_prices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
</code></pre></div>

<h4>Step 3. Get the stock price 20, 120, 252 trading days after the Annual Report Release Date</h4>
<p>Then we add 20 (or 120 or 252) trading days to the release dates, and try to get the closing stock price of the specified company on those dates. Here we use 20 trading days as example, for 120 and 252 trading days, we only need to change the n accordingly. </p>
<div class="highlight"><pre><span></span><code> <span class="k">for</span> <span class="n">ticker</span><span class="p">,</span> <span class="n">date</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">tickers</span><span class="p">,</span> <span class="n">dates</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># get price data from Yahoo Finance, from start date:</span>
        <span class="n">stock</span> <span class="o">=</span> <span class="n">yf</span><span class="o">.</span><span class="n">Ticker</span><span class="p">(</span><span class="n">ticker</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">stock</span><span class="o">.</span><span class="n">history</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">date</span><span class="p">)</span>

        <span class="c1"># find the 1st recorded date</span>
        <span class="n">first_valid_date</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">row</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Company&#39;</span><span class="p">:</span> <span class="n">ticker</span><span class="p">,</span>
            <span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="n">date</span>
            <span class="p">}</span>

        <span class="c1"># get the stock price 20 (/120/252) days later</span>
        <span class="c1"># here we use 20 trading days as example.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">target_date_20</span> <span class="o">=</span> <span class="n">first_valid_date</span> <span class="o">+</span>\
                 <span class="n">pd</span><span class="o">.</span><span class="n">tseries</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">BusinessDay</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>  
            <span class="c1"># change n to 120, 252 for 120 and 252 trading days</span>

            <span class="c1"># here change 20 to 120, 252 accordingly to the n used above</span>
            <span class="n">close_price_20</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">target_date_20</span><span class="p">,</span> <span class="s1">&#39;Close&#39;</span><span class="p">]</span>
            <span class="n">row</span><span class="p">[</span><span class="s1">&#39;close_price_20_days_later&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">close_price_20</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">row</span><span class="p">[</span><span class="s1">&#39;close_price_20_days_later&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Didn&#39;t find </span><span class="si">{</span><span class="n">ticker</span><span class="si">}</span><span class="s2"> on </span><span class="si">{</span><span class="n">target_date_20</span><span class="si">}</span><span class="s2"> &#39;s price。&quot;</span><span class="p">)</span>
        <span class="n">close_prices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
</code></pre></div>

<h4>Step 4. Get the S&amp;P 500 closing price 20, 120, 252 trading days after specific date</h4>
<p>After we get the closing stock price of the specified company on those dates, we get the corresponding S&amp;P500 closing price and calculate the return. </p>
<div class="highlight"><pre><span></span><code> <span class="c1"># get S&amp;P 500 data</span>
 <span class="n">sp500</span> <span class="o">=</span> <span class="n">yf</span><span class="o">.</span><span class="n">Ticker</span><span class="p">(</span><span class="s2">&quot;^GSPC&quot;</span><span class="p">)</span>

 <span class="c1"># create an empty list to store S&amp;P 500 close price</span>
 <span class="n">sp500_prices</span> <span class="o">=</span> <span class="p">[]</span>

 <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Filing Date&#39;</span><span class="p">]:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># get S&amp;P 500 historical data</span>
        <span class="n">history</span> <span class="o">=</span> <span class="n">sp500</span><span class="o">.</span><span class="n">history</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">date</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">date</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">history</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">price</span> <span class="o">=</span> <span class="n">history</span><span class="p">[</span><span class="s1">&#39;Close&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">sp500_prices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">price</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># if there&#39;s no data, add NaN</span>
            <span class="n">sp500_prices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error fetching data for </span><span class="si">{</span><span class="n">date</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">sp500_prices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">))</span>

 <span class="c1"># put S&amp;P 500 close price into DataFrame as new column</span>
 <span class="n">df</span><span class="p">[</span><span class="s1">&#39;S&amp;P500_Close_Price&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sp500_prices</span>

 <span class="c1"># Define function</span>
 <span class="k">def</span> <span class="nf">get_nth_business_day</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">next_date</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">bdate_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">date</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">next_date</span>
    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

 <span class="c1"># Define Business day interval</span>
 <span class="n">periods</span> <span class="o">=</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">252</span><span class="p">]</span>

 <span class="c1"># List for Data Storage</span>
 <span class="n">returns</span> <span class="o">=</span> <span class="p">{</span><span class="sa">f</span><span class="s1">&#39;S&amp;P500_Return_</span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s1">_days&#39;</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">periods</span><span class="p">}</span>
</code></pre></div>

<p>Here we encountered problem getting all the stock prices and S&amp;P500 on the date we required. For example, we get empty value (NaN) for the stock price of companies like AAPL, WMT and NVDA on 14 April 2022. Thus, we further improve our coding.</p>
<h3>3.2 Improved Version of Stock Price Collection</h3>
<p>To deal with the empty values, we decided to use the stock price one business day after our required business date. And for the other stock price, we still use the original dates' value. And below are the codes we used for improvement:</p>
<h4>Add a Helper Function to deal with empty value:</h4>
<p>To deal with the empty values, we add a helper function in our code. This helper function will automatically get the closing stock price one business day after the missing value date.</p>
<div class="highlight"><pre><span></span><code> <span class="c1"># Helper function to get the price and handle missing data</span>
 <span class="k">def</span> <span class="nf">get_price</span><span class="p">(</span><span class="n">target_date</span><span class="p">):</span>
    <span class="k">while</span> <span class="n">target_date</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
        <span class="c1"># Move to the next business day</span>
        <span class="n">target_date</span> <span class="o">+=</span> <span class="n">pd</span><span class="o">.</span><span class="n">tseries</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">BusinessDay</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  
    <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">target_date</span><span class="p">,</span> <span class="s1">&#39;Close&#39;</span><span class="p">]</span>
</code></pre></div>

<h3>3.3 Further Process Stock Price and Get Stock Performance</h3>
<p>After we get the adjusted closing stock price, we need to process the data for further analysis. Here in our project, we would like to see the future tendency of the stock price. For stock's return that will be greater than the according S&amp;P500's return for the specified number of trading days, we would assign value '1', while for stock's return that will be greater than the according S&amp;P500's return for the specified number of trading days, we would assign value '0'. And we store the value in the excel document together with the stock price we get for later analysis.</p>
<h4>Compare the adjusted closing price and assign values</h4>
<p>Here is the function we used to assgin value to excess stock returns. And this data will be used later in the machine learning.</p>
<div class="highlight"><pre><span></span><code> <span class="c1"># Calculte the return of S&amp;P500 and compare with stocks</span>
 <span class="k">def</span> <span class="nf">calculate_value_metrics</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="n">sp500_returns</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">value_cols</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">date</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sp500_returns</span><span class="p">:</span>
            <span class="n">sp500_returns</span><span class="p">[</span><span class="n">date</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_sp500_returns</span><span class="p">(</span><span class="n">date</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">period</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">252</span><span class="p">]:</span>
            <span class="n">stock_return</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;return_</span><span class="si">{</span><span class="n">period</span><span class="si">}</span><span class="s1">_days_later&#39;</span><span class="p">]</span>
            <span class="n">sp500_return</span> <span class="o">=</span> <span class="n">sp500_returns</span><span class="p">[</span><span class="n">date</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

            <span class="n">col_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;value_</span><span class="si">{</span><span class="n">period</span><span class="si">}</span><span class="s1">_days&#39;</span>
            <span class="k">if</span> <span class="n">col_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">value_cols</span><span class="p">:</span>
                <span class="n">value_cols</span><span class="p">[</span><span class="n">col_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">stock_return</span><span class="p">)</span> <span class="ow">or</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">sp500_return</span><span class="p">):</span>
                <span class="n">value_cols</span><span class="p">[</span><span class="n">col_name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value_cols</span><span class="p">[</span><span class="n">col_name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>\
                  <span class="mi">1</span> <span class="k">if</span> <span class="n">stock_return</span> <span class="o">&gt;</span> <span class="n">sp500_return</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">col_name</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">value_cols</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">df</span><span class="p">[</span><span class="n">col_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span>

    <span class="k">return</span> <span class="n">df</span>
</code></pre></div>

<h3>3.4 Covert all the data we get into DataFrame and Store it in Excel</h3>
<p>After we get the adjusted closing stock price for the specific days and process the data, we store the information for future use. Here we use the library <a href="https://pandas.pydata.org">pandas</a> to assist.</p>
<div class="highlight"><pre><span></span><code> <span class="c1"># convert to DataFrame</span>
 <span class="n">result_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">close_prices</span><span class="p">)</span>
 <span class="c1"># save outcome to a new Excel file</span>
 <span class="n">result_df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s1">&#39;stock_close_prices_result.xlsx&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>

<h2>4. Linear Regression</h2>
<h3>4.1 One-Dimensional Linear Regression</h3>
<p>Initially we considered the linear relationship between one single factor, the frequency of occurrence of hedging words in the text of the annual reports, and the return on the company's share price, and ran a one-dimensional linear regression. </p>
<h4>Model Specification</h4>
<p>For simple linear regression (with one independent variable), we chose Uncertainty_Frequency_Percentage as the independent variable x<sub>i</sub> and and stock return as the dependent vairable y<sub>i</sub>, the model is specified as:</p>
<p>y<sub>i</sub> = β<sub>0</sub> + β<sub>1</sub>x<sub>i</sub> + ϵ<sub>i</sub></p>
<p>where β<sub>0</sub> is the intercept, β<sub>1</sub> is the slope coefficient, and ϵ<sub>i</sub> is the error term. We conduct 3 simple linear regressions with return_20_days, return_120_days, and return_252_days as the dependent variables. We show the code of one of them as an example here:</p>
<div class="highlight"><pre><span></span><code> <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
 <span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span>
 <span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">r2_score</span>

 <span class="c1"># read csv file</span>
 <span class="n">file_path</span> <span class="o">=</span> <span class="s1">&#39;merged_file.csv&#39;</span>  <span class="c1"># replace this as your file path</span>
 <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
 <span class="c1"># Extract the independent variable X</span>
 <span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="s1">&#39;Uncertainty_Frequency_Percentage&#39;</span><span class="p">]]</span>
 <span class="c1"># Perform linear regression with &#39;return_20_days&#39; as the dependent variable</span>
 <span class="n">y1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;return_20_days&#39;</span><span class="p">]</span>

 <span class="c1"># create linear regression model</span>
 <span class="n">model1</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
 <span class="c1"># Fit the model</span>
 <span class="n">model1</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y1</span><span class="p">)</span>
 <span class="c1"># predict</span>
 <span class="n">y1_pred</span> <span class="o">=</span> <span class="n">model1</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
 <span class="c1"># Calculate the R² score</span>
 <span class="n">r2_1</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">y1_pred</span><span class="p">)</span>

 <span class="c1"># output</span>
 <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Results of the linear regression with &#39;return_20_days&#39; as the dependent variable:&quot;</span><span class="p">)</span>
 <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Slope (Coefficient): </span><span class="si">{</span><span class="n">model1</span><span class="o">.</span><span class="n">coef_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
 <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Intercept: </span><span class="si">{</span><span class="n">model1</span><span class="o">.</span><span class="n">intercept_</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
 <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;R² : </span><span class="si">{</span><span class="n">r2_1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h4>Model Evaluation:</h4>
<p>After conducting the first simple regression, we calculated the coefficient of determination R^2, which represents the proportion of the total variation in the dependent variable y that is explained by the independent variable in the model. The results are as follows:<br>
<img alt="Model Evaluation Result" src="./images/group-LanguageMagician_02_image-ModelEvaluation.png"></p>
<p>We apply it to the next 2 simple regressions, and we found that the R^2 for all these models are relatively small: 0.013235334749482797, 0.004085284566068048 and 0.021045320217781938. The models did not fit very well, and we thought the reason might be that important independent variables were missing, so we introduced two more factors and set the dependent variable to excess return.</p>
<h3>4.2 Multiple Linear Regression</h3>
<p>Based on our previous analysis, we decided to add 2 more independent variables in our regression model: average sentence length and proportion of complex words (word that contain more than 2 syllables). What's more, we decided to adapt stock's excess return (stock return - S&amp;P500 return) as our new dependent variable, which can eliminate disruptions of the market factor. After the above preparations, we performed new multiple linear regressions:</p>
<p>y<sub>i</sub> = β<sub>0</sub> + β<sub>1</sub>x<sub>1,i</sub> + β<sub>2</sub>x<sub>2,i</sub> + β<sub>3</sub>x<sub>3,i</sub> + ϵ<sub>i</sub></p>
<p>Part of the code is as follows:</p>
<div class="highlight"><pre><span></span><code> <span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
 <span class="c1"># Define Independent and Dependent Variable</span>
 <span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;excess_return_20_days&#39;</span><span class="p">]</span>
 <span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;pct_complex_words&#39;</span><span class="p">,</span> <span class="s1">&#39;Uncertainty_Frequency_Percentage&#39;</span><span class="p">,</span> <span class="s1">&#39;avg_sentence_length&#39;</span><span class="p">]]</span>

 <span class="c1"># Add intersection</span>
 <span class="n">X</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

 <span class="c1"># Linear Regression</span>
 <span class="n">model</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

 <span class="c1"># Print Regression Result</span>
 <span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</code></pre></div>

<p>We only illustrate using the 20 days excess return here. After we conducted the regression, we found that the R^2 of the models were still small. The result indicated that there's no significant linear relationship between the stock excess return and the language ambiguity of conpany annual reports. </p>
<h2>5. Machine Learning</h2>
<h3>5.1 Naive Bayes Model</h3>
<p>As we couldn't find the linear relationship between the stock excess return and the language ambiguity of company annual reports, we decided to directly apply machine learning methods. We used the first three years' data as the training set and the last year's data as the testing set. In the beginning, we only considered the relationship between the stock return and the frequency of uncertainty words, and processed the return data by assigning a value of one to the stocks with positive returns and the opposite to zero. </p>
<div class="highlight"><pre><span></span><code> <span class="c1"># find the previous 3 year and the last year</span>
 <span class="n">years</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
 <span class="n">train_years</span> <span class="o">=</span> <span class="n">years</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
 <span class="n">test_year</span> <span class="o">=</span> <span class="n">years</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

 <span class="c1"># extract previous 3 years&#39; data as the training set</span>
 <span class="n">train_df</span> <span class="o">=</span> <span class="n">merged_df</span><span class="p">[</span><span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">train_years</span><span class="p">)]</span>

 <span class="c1"># extract the data in the last year as the testing set</span>
 <span class="n">test_df</span> <span class="o">=</span> <span class="n">merged_df</span><span class="p">[</span><span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">test_year</span><span class="p">]</span>


 <span class="n">X_train</span> <span class="o">=</span> <span class="n">train_df</span><span class="p">[[</span><span class="s1">&#39;Uncertainty_Frequency_Percentage&#39;</span><span class="p">]]</span>
 <span class="n">X_test</span> <span class="o">=</span> <span class="n">test_df</span><span class="p">[[</span><span class="s1">&#39;Uncertainty_Frequency_Percentage&#39;</span><span class="p">]]</span>

 <span class="n">ylist_train</span> <span class="o">=</span> <span class="p">[</span><span class="n">train_df</span><span class="p">[[</span><span class="s1">&#39;value_20_days&#39;</span><span class="p">]],</span> <span class="n">train_df</span><span class="p">[[</span><span class="s1">&#39;value_120_days&#39;</span><span class="p">]],</span> <span class="n">train_df</span><span class="p">[[</span><span class="s1">&#39;value_252_days&#39;</span><span class="p">]]]</span>
 <span class="n">ylist_test</span> <span class="o">=</span> <span class="p">[</span><span class="n">test_df</span><span class="p">[[</span><span class="s1">&#39;value_20_days&#39;</span><span class="p">]],</span> <span class="n">test_df</span><span class="p">[[</span><span class="s1">&#39;value_120_days&#39;</span><span class="p">]],</span> <span class="n">test_df</span><span class="p">[[</span><span class="s1">&#39;value_252_days&#39;</span><span class="p">]]]</span>

 <span class="n">Accuracy</span> <span class="o">=</span> <span class="p">[]</span>
 <span class="n">Matrix</span> <span class="o">=</span> <span class="p">[]</span>

 <span class="k">for</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ylist_train</span><span class="p">,</span> <span class="n">ylist_test</span><span class="p">):</span>
    <span class="n">y_train</span> <span class="o">=</span> <span class="n">y_train</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
    <span class="n">y_test</span> <span class="o">=</span> <span class="n">y_test</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>

    <span class="n">nb</span> <span class="o">=</span> <span class="n">MultinomialNB</span><span class="p">()</span>
    <span class="n">nb</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">nb</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
    <span class="n">Accuracy</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">y_train</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">metrics</span><span class="o">.</span><span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">pred</span><span class="p">)))</span>
    <span class="n">Matrix</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">y_train</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">metrics</span><span class="o">.</span><span class="n">confusion_matrix</span><span class="p">(</span>
        <span class="n">y_test</span><span class="p">,</span>  <span class="c1"># Actual labels.</span>
        <span class="n">pred</span><span class="p">,</span>  <span class="c1"># Labels predicted by naive Bayes model.</span>
        <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># Reorder the resulting matrix.</span>
    <span class="p">)))</span>

 <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">Accuracy</span><span class="p">)):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;For </span><span class="si">{</span><span class="n">Accuracy</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">, the prediction accuracy score is </span><span class="si">{</span><span class="n">Accuracy</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;For </span><span class="si">{</span><span class="n">Matrix</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">, the confusion matrix is </span><span class="si">{</span><span class="n">Matrix</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</code></pre></div>

<p>For value_20_days, the prediction accuracy score is 0.3, for value_120_days, the prediction accuracy score is 0.6666666666666666, for value_252_days, the prediction accuracy score is 0.8333333333333334. </p>
<p><img alt="Naive Bayes Model Result" src="./images/group-LanguageMagician_02_image-NaiveBayesModel.png"></p>
<p>Although the prediction accuracy score is high for value_252_days, we found the confusion matrix was [[0, 5], [0, 25]], which means that it did not correctly identify any of the negative class samples, incorrectly predicting all actual negative class samples as positive. By observing the raw data, we found that most stocks' price have experienced positive growth. As a result, the 0_values were much less than 1_value, making the model not efficient enough. </p>
<h3>5.2 Random Forest</h3>
<p>In order to capture more nonlinear relationship and get more accuracy, we chose Random Forest model to train and test. What's more, it has good anti - overfitting ability. Through bootstrap sampling and random feature selection, it increases the diversity of the model and reduces the risk of overfitting of a single decision tree. 
 Considering stock excess return and 2 new factors: average sentence length and proportion of complex words (word that contain more than 2 syllables), we conducted Random Forest model. First, we prepared the data for machine learning, using X to store feature columns and y to store target columns:</p>
<div class="highlight"><pre><span></span><code> <span class="c1"># Add value metrics to the dataset</span>
 <span class="n">data</span> <span class="o">=</span> <span class="n">calculate_value_metrics</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

 <span class="c1"># Prepare data for machine learning</span>
 <span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;avg_sentence_length&#39;</span><span class="p">,</span> <span class="s1">&#39;pct_complex_words&#39;</span><span class="p">,</span> <span class="s1">&#39;Uncertainty_Frequency_Percentage&#39;</span><span class="p">]</span>
 <span class="n">targets</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;value_20_days&#39;</span><span class="p">,</span> <span class="s1">&#39;value_120_days&#39;</span><span class="p">,</span> <span class="s1">&#39;value_252_days&#39;</span><span class="p">]</span>

 <span class="c1"># Remove rows with NaN values</span>
 <span class="n">model_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">features</span> <span class="o">+</span> <span class="n">targets</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

 <span class="n">X</span> <span class="o">=</span> <span class="n">model_data</span><span class="p">[</span><span class="n">features</span><span class="p">]</span>
 <span class="n">y</span> <span class="o">=</span> <span class="n">model_data</span><span class="p">[</span><span class="n">targets</span><span class="p">]</span>
</code></pre></div>

<p>Next we created and trained a Random Forest classification model, 20% of the data is split into the test set, and 80% is split into the training set. We used training set data to train the model and then used the trained model to make predictions on the features of the test set and returns the prediction results. After that, we calculated the accuracy between the prediction results and the true results. We stored the model and accuracy corresponding to the current target variable in the models and accuracies dictionaries respectively.</p>
<div class="highlight"><pre><span></span><code> <span class="c1"># Split data for each target and train models</span>
 <span class="n">models</span> <span class="o">=</span> <span class="p">{}</span>
 <span class="n">accuracies</span> <span class="o">=</span> <span class="p">{}</span>

 <span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">targets</span><span class="p">:</span>
    <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
        <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="n">target</span><span class="p">],</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span>
    <span class="p">)</span>

    <span class="c1"># Random Forest Classifier</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

    <span class="c1"># Predictions and accuracy</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
    <span class="n">accuracy</span> <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>

    <span class="n">models</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span>
    <span class="n">accuracies</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">=</span> <span class="n">accuracy</span>
</code></pre></div>

<p>We also used the DataFrame function of pandas to combine the feature names and the corresponding importance scores of each feature in the Random Forest model into a data frame.</p>
<div class="highlight"><pre><span></span><code> <span class="c1"># Feature importance</span>
 <span class="n">feature_importance</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;feature&#39;</span><span class="p">:</span> <span class="n">features</span><span class="p">,</span>
    <span class="s1">&#39;importance&#39;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">feature_importances_</span>
    <span class="p">})</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;importance&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

 <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Results for </span><span class="si">{</span><span class="n">target</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
 <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Accuracy: </span><span class="si">{</span><span class="n">accuracy</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
 <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Feature Importance:&quot;</span><span class="p">)</span>
 <span class="nb">print</span><span class="p">(</span><span class="n">feature_importance</span><span class="p">)</span>

 <span class="c1"># Overall analysis</span>
 <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Overall Model Performance:&quot;</span><span class="p">)</span>
 <span class="k">for</span> <span class="n">target</span><span class="p">,</span> <span class="n">accuracy</span> <span class="ow">in</span> <span class="n">accuracies</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">target</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">accuracy</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

 <span class="c1"># Correlation analysis</span>
 <span class="n">correlation_matrix</span> <span class="o">=</span> <span class="n">model_data</span><span class="p">[</span><span class="n">features</span> <span class="o">+</span> <span class="n">targets</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
 <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Correlation Matrix:&quot;</span><span class="p">)</span>
 <span class="nb">print</span><span class="p">(</span><span class="n">correlation_matrix</span><span class="p">)</span>
</code></pre></div>

<p>We drew the feature importance and the correlation heatmap:
 <img alt="Importance Feature" src="./images/group-LanguageMagician_02_image-ImportanceFeature.png">
 <img alt="Correlation Heatmap" src="./images/group-LanguageMagician_02_image-CorrelationHeatmap.png"></p>


             
 
            
            
            







            <hr/>
        </div>
        <section id="article-sidebar" class="span2">
            <h4>Published</h4>
            <time itemprop="dateCreated" datetime="2025-03-10T00:00:00+08:00">Mon 10 March 2025</time>
            <h4>Category</h4>
            <a class="category-link" href="/categories.html#reflective-report-ref">Reflective Report</a>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="/tags.html#group-language-magician-ref">Group Language Magician
                    <span class="superscript">2</span>
</a></li>
            </ul>
<h4>Contact</h4>
<div id="sidebar-social-link">
    <a href="https://github.com/buehlmaier/MFIN7036-student-blog-2025-01" title="" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="GitHub" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#1B1817"/><path fill="#fff" d="M335 499c14 0 12 17 12 17H165s-2-17 12-17c13 0 16-6 16-12l-1-50c-71 16-86-28-86-28-12-30-28-37-28-37-24-16 1-16 1-16 26 2 40 26 40 26 22 39 59 28 74 22 2-17 9-28 16-35-57-6-116-28-116-126 0-28 10-51 26-69-3-6-11-32 3-67 0 0 21-7 70 26 42-12 86-12 128 0 49-33 70-26 70-26 14 35 6 61 3 67 16 18 26 41 26 69 0 98-60 120-117 126 10 8 18 24 18 48l-1 70c0 6 3 12 16 12z"/></svg>
    </a>
</div>
            





            





        </section>
</div>
</article>
<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe.
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides.
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo https://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>                    </div>
                    <div class="span1"></div>
                </div>
            </div>
        </div>
<footer>




    <div id="fpowered">
        Powered by: <a href="http://getpelican.com/" title="Pelican Home Page" target="_blank" rel="nofollow noopener noreferrer">Pelican</a>
        Theme: <a href="https://elegant.oncrashreboot.com/" title="Theme Elegant Home Page" target="_blank" rel="nofollow noopener noreferrer">Elegant</a>
    </div>
</footer>            <script src="//code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script src="/theme/js/elegant.prod.9e9d5ce754.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

    <script>
    (function () {
        if (window.location.hash.match(/^#comment-\d+$/)) {
            $('#comment_thread').collapse('show');
        }
    })();
    window.onhashchange=function(){
        if (window.location.hash.match(/^#comment-\d+$/))
            window.location.reload(true);
    }
    $('#comment_thread').on('shown', function () {
        var link = document.getElementById('comment-accordion-toggle');
        var old_innerHTML = link.innerHTML;
        $(link).fadeOut(200, function() {
            $(this).text('Click here to hide comments').fadeIn(200);
        });
        $('#comment_thread').on('hidden', function () {
            $(link).fadeOut(200, function() {
                $(this).text(old_innerHTML).fadeIn(200);
            });
        })
    })
</script>

    </body>
    <!-- Theme: Elegant built for Pelican
        License : MIT -->
</html>